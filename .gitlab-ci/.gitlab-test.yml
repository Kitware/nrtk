###############################################################################
# Stage -- Unit Testing
###############################################################################
#
# Overrides:
#
# 1) nrtk specific notebooks.
# 2) Poetry install for optional dependencies
#
###############################################################################

.test-setup:
  before_script:
    - !reference [.shared-setup, before_script]
    - poetry install --sync --only main,tests --extras "pybsm maite tools headless Pillow scikit-image"

notebooks:
  parallel:
    matrix:
      # Sequences combinatorically combine within a list entry
      - NOTEBOOK_DIR: "examples"
        NOTEBOOK_FILE: [
          "coco_scorer.ipynb",
          "perturbers.ipynb",
          "simple_generic_generator.ipynb",
          "simple_pybsm_generator.ipynb"
        ]
      - NOTEBOOK_DIR: "examples/pybsm"
        NOTEBOOK_FILE: [
          "pybsm_test.ipynb"
        ]
      - NOTEBOOK_DIR: "examples/maite"
        NOTEBOOK_FILE: [
          "augmentations.ipynb",
          #"compute_image_metric.ipynb",
          "jatic-perturbations-saliency.ipynb",
          "nrtk_brightness_perturber_demo.ipynb",
          "nrtk_turbulence_perturber_demo.ipynb",
        ]
      - NOTEBOOK_DIR: "examples/maite/gradio"
        NOTEBOOK_FILE: [
          "nrtk-gradio.ipynb"
        ]
